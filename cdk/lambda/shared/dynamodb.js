"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DynamoDBService = exports.TABLES = exports.dynamoDb = void 0;
const client_dynamodb_1 = require("@aws-sdk/client-dynamodb");
const lib_dynamodb_1 = require("@aws-sdk/lib-dynamodb");
// Initialize DynamoDB client
const client = new client_dynamodb_1.DynamoDBClient({ region: process.env.AWS_REGION || 'us-east-1' });
exports.dynamoDb = lib_dynamodb_1.DynamoDBDocumentClient.from(client);
// Table names from environment variables
exports.TABLES = {
    USERS: process.env.USERS_TABLE_NAME || 'EducateFirstAi-Users',
    CONVERSATIONS: process.env.CONVERSATIONS_TABLE_NAME || 'EducateFirstAi-Conversations',
    USER_PROGRESS: process.env.USER_PROGRESS_TABLE_NAME || 'EducateFirstAi-UserProgress',
    RESPONSE_CACHE: process.env.RESPONSE_CACHE_TABLE_NAME || 'EducateFirstAi-ResponseCache',
};
// Common DynamoDB operations
class DynamoDBService {
    static async putItem(tableName, item) {
        const command = new lib_dynamodb_1.PutCommand({
            TableName: tableName,
            Item: item,
        });
        return await exports.dynamoDb.send(command);
    }
    static async getItem(tableName, key) {
        const command = new lib_dynamodb_1.GetCommand({
            TableName: tableName,
            Key: key,
        });
        const result = await exports.dynamoDb.send(command);
        return result.Item;
    }
    static async queryItems(tableName, keyConditionExpression, expressionAttributeValues, indexName) {
        const command = new lib_dynamodb_1.QueryCommand({
            TableName: tableName,
            KeyConditionExpression: keyConditionExpression,
            ExpressionAttributeValues: expressionAttributeValues,
            IndexName: indexName,
        });
        const result = await exports.dynamoDb.send(command);
        return result.Items || [];
    }
    static async updateItem(tableName, key, updateExpression, expressionAttributeValues) {
        const command = new lib_dynamodb_1.UpdateCommand({
            TableName: tableName,
            Key: key,
            UpdateExpression: updateExpression,
            ExpressionAttributeValues: expressionAttributeValues,
            ReturnValues: 'ALL_NEW',
        });
        const result = await exports.dynamoDb.send(command);
        return result.Attributes;
    }
    static async deleteItem(tableName, key) {
        const command = new lib_dynamodb_1.DeleteCommand({
            TableName: tableName,
            Key: key,
        });
        return await exports.dynamoDb.send(command);
    }
}
exports.DynamoDBService = DynamoDBService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1vZGIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJkeW5hbW9kYi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSw4REFBMEQ7QUFDMUQsd0RBQW1JO0FBRW5JLDZCQUE2QjtBQUM3QixNQUFNLE1BQU0sR0FBRyxJQUFJLGdDQUFjLENBQUMsRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksV0FBVyxFQUFFLENBQUMsQ0FBQztBQUN4RSxRQUFBLFFBQVEsR0FBRyxxQ0FBc0IsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7QUFFNUQseUNBQXlDO0FBQzVCLFFBQUEsTUFBTSxHQUFHO0lBQ3BCLEtBQUssRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUFnQixJQUFJLHNCQUFzQjtJQUM3RCxhQUFhLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsSUFBSSw4QkFBOEI7SUFDckYsYUFBYSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0JBQXdCLElBQUksNkJBQTZCO0lBQ3BGLGNBQWMsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLHlCQUF5QixJQUFJLDhCQUE4QjtDQUN4RixDQUFDO0FBRUYsNkJBQTZCO0FBQzdCLE1BQWEsZUFBZTtJQUMxQixNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFpQixFQUFFLElBQVM7UUFDL0MsTUFBTSxPQUFPLEdBQUcsSUFBSSx5QkFBVSxDQUFDO1lBQzdCLFNBQVMsRUFBRSxTQUFTO1lBQ3BCLElBQUksRUFBRSxJQUFJO1NBQ1gsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxNQUFNLGdCQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRCxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFpQixFQUFFLEdBQVE7UUFDOUMsTUFBTSxPQUFPLEdBQUcsSUFBSSx5QkFBVSxDQUFDO1lBQzdCLFNBQVMsRUFBRSxTQUFTO1lBQ3BCLEdBQUcsRUFBRSxHQUFHO1NBQ1QsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxNQUFNLEdBQUcsTUFBTSxnQkFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM1QyxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDckIsQ0FBQztJQUVELE1BQU0sQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLFNBQWlCLEVBQUUsc0JBQThCLEVBQUUseUJBQThCLEVBQUUsU0FBa0I7UUFDM0gsTUFBTSxPQUFPLEdBQUcsSUFBSSwyQkFBWSxDQUFDO1lBQy9CLFNBQVMsRUFBRSxTQUFTO1lBQ3BCLHNCQUFzQixFQUFFLHNCQUFzQjtZQUM5Qyx5QkFBeUIsRUFBRSx5QkFBeUI7WUFDcEQsU0FBUyxFQUFFLFNBQVM7U0FDckIsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxNQUFNLEdBQUcsTUFBTSxnQkFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM1QyxPQUFPLE1BQU0sQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFFRCxNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxTQUFpQixFQUFFLEdBQVEsRUFBRSxnQkFBd0IsRUFBRSx5QkFBOEI7UUFDM0csTUFBTSxPQUFPLEdBQUcsSUFBSSw0QkFBYSxDQUFDO1lBQ2hDLFNBQVMsRUFBRSxTQUFTO1lBQ3BCLEdBQUcsRUFBRSxHQUFHO1lBQ1IsZ0JBQWdCLEVBQUUsZ0JBQWdCO1lBQ2xDLHlCQUF5QixFQUFFLHlCQUF5QjtZQUNwRCxZQUFZLEVBQUUsU0FBUztTQUN4QixDQUFDLENBQUM7UUFDSCxNQUFNLE1BQU0sR0FBRyxNQUFNLGdCQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzVDLE9BQU8sTUFBTSxDQUFDLFVBQVUsQ0FBQztJQUMzQixDQUFDO0lBRUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsU0FBaUIsRUFBRSxHQUFRO1FBQ2pELE1BQU0sT0FBTyxHQUFHLElBQUksNEJBQWEsQ0FBQztZQUNoQyxTQUFTLEVBQUUsU0FBUztZQUNwQixHQUFHLEVBQUUsR0FBRztTQUNULENBQUMsQ0FBQztRQUNILE9BQU8sTUFBTSxnQkFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN0QyxDQUFDO0NBQ0Y7QUFoREQsMENBZ0RDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRHluYW1vREJDbGllbnQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtZHluYW1vZGInO1xuaW1wb3J0IHsgRHluYW1vREJEb2N1bWVudENsaWVudCwgUHV0Q29tbWFuZCwgR2V0Q29tbWFuZCwgUXVlcnlDb21tYW5kLCBVcGRhdGVDb21tYW5kLCBEZWxldGVDb21tYW5kIH0gZnJvbSAnQGF3cy1zZGsvbGliLWR5bmFtb2RiJztcblxuLy8gSW5pdGlhbGl6ZSBEeW5hbW9EQiBjbGllbnRcbmNvbnN0IGNsaWVudCA9IG5ldyBEeW5hbW9EQkNsaWVudCh7IHJlZ2lvbjogcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiB8fCAndXMtZWFzdC0xJyB9KTtcbmV4cG9ydCBjb25zdCBkeW5hbW9EYiA9IER5bmFtb0RCRG9jdW1lbnRDbGllbnQuZnJvbShjbGllbnQpO1xuXG4vLyBUYWJsZSBuYW1lcyBmcm9tIGVudmlyb25tZW50IHZhcmlhYmxlc1xuZXhwb3J0IGNvbnN0IFRBQkxFUyA9IHtcbiAgVVNFUlM6IHByb2Nlc3MuZW52LlVTRVJTX1RBQkxFX05BTUUgfHwgJ0VkdWNhdGVGaXJzdEFpLVVzZXJzJyxcbiAgQ09OVkVSU0FUSU9OUzogcHJvY2Vzcy5lbnYuQ09OVkVSU0FUSU9OU19UQUJMRV9OQU1FIHx8ICdFZHVjYXRlRmlyc3RBaS1Db252ZXJzYXRpb25zJyxcbiAgVVNFUl9QUk9HUkVTUzogcHJvY2Vzcy5lbnYuVVNFUl9QUk9HUkVTU19UQUJMRV9OQU1FIHx8ICdFZHVjYXRlRmlyc3RBaS1Vc2VyUHJvZ3Jlc3MnLFxuICBSRVNQT05TRV9DQUNIRTogcHJvY2Vzcy5lbnYuUkVTUE9OU0VfQ0FDSEVfVEFCTEVfTkFNRSB8fCAnRWR1Y2F0ZUZpcnN0QWktUmVzcG9uc2VDYWNoZScsXG59O1xuXG4vLyBDb21tb24gRHluYW1vREIgb3BlcmF0aW9uc1xuZXhwb3J0IGNsYXNzIER5bmFtb0RCU2VydmljZSB7XG4gIHN0YXRpYyBhc3luYyBwdXRJdGVtKHRhYmxlTmFtZTogc3RyaW5nLCBpdGVtOiBhbnkpIHtcbiAgICBjb25zdCBjb21tYW5kID0gbmV3IFB1dENvbW1hbmQoe1xuICAgICAgVGFibGVOYW1lOiB0YWJsZU5hbWUsXG4gICAgICBJdGVtOiBpdGVtLFxuICAgIH0pO1xuICAgIHJldHVybiBhd2FpdCBkeW5hbW9EYi5zZW5kKGNvbW1hbmQpO1xuICB9XG5cbiAgc3RhdGljIGFzeW5jIGdldEl0ZW0odGFibGVOYW1lOiBzdHJpbmcsIGtleTogYW55KSB7XG4gICAgY29uc3QgY29tbWFuZCA9IG5ldyBHZXRDb21tYW5kKHtcbiAgICAgIFRhYmxlTmFtZTogdGFibGVOYW1lLFxuICAgICAgS2V5OiBrZXksXG4gICAgfSk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZHluYW1vRGIuc2VuZChjb21tYW5kKTtcbiAgICByZXR1cm4gcmVzdWx0Lkl0ZW07XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgcXVlcnlJdGVtcyh0YWJsZU5hbWU6IHN0cmluZywga2V5Q29uZGl0aW9uRXhwcmVzc2lvbjogc3RyaW5nLCBleHByZXNzaW9uQXR0cmlidXRlVmFsdWVzOiBhbnksIGluZGV4TmFtZT86IHN0cmluZykge1xuICAgIGNvbnN0IGNvbW1hbmQgPSBuZXcgUXVlcnlDb21tYW5kKHtcbiAgICAgIFRhYmxlTmFtZTogdGFibGVOYW1lLFxuICAgICAgS2V5Q29uZGl0aW9uRXhwcmVzc2lvbjoga2V5Q29uZGl0aW9uRXhwcmVzc2lvbixcbiAgICAgIEV4cHJlc3Npb25BdHRyaWJ1dGVWYWx1ZXM6IGV4cHJlc3Npb25BdHRyaWJ1dGVWYWx1ZXMsXG4gICAgICBJbmRleE5hbWU6IGluZGV4TmFtZSxcbiAgICB9KTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkeW5hbW9EYi5zZW5kKGNvbW1hbmQpO1xuICAgIHJldHVybiByZXN1bHQuSXRlbXMgfHwgW107XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgdXBkYXRlSXRlbSh0YWJsZU5hbWU6IHN0cmluZywga2V5OiBhbnksIHVwZGF0ZUV4cHJlc3Npb246IHN0cmluZywgZXhwcmVzc2lvbkF0dHJpYnV0ZVZhbHVlczogYW55KSB7XG4gICAgY29uc3QgY29tbWFuZCA9IG5ldyBVcGRhdGVDb21tYW5kKHtcbiAgICAgIFRhYmxlTmFtZTogdGFibGVOYW1lLFxuICAgICAgS2V5OiBrZXksXG4gICAgICBVcGRhdGVFeHByZXNzaW9uOiB1cGRhdGVFeHByZXNzaW9uLFxuICAgICAgRXhwcmVzc2lvbkF0dHJpYnV0ZVZhbHVlczogZXhwcmVzc2lvbkF0dHJpYnV0ZVZhbHVlcyxcbiAgICAgIFJldHVyblZhbHVlczogJ0FMTF9ORVcnLFxuICAgIH0pO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGR5bmFtb0RiLnNlbmQoY29tbWFuZCk7XG4gICAgcmV0dXJuIHJlc3VsdC5BdHRyaWJ1dGVzO1xuICB9XG5cbiAgc3RhdGljIGFzeW5jIGRlbGV0ZUl0ZW0odGFibGVOYW1lOiBzdHJpbmcsIGtleTogYW55KSB7XG4gICAgY29uc3QgY29tbWFuZCA9IG5ldyBEZWxldGVDb21tYW5kKHtcbiAgICAgIFRhYmxlTmFtZTogdGFibGVOYW1lLFxuICAgICAgS2V5OiBrZXksXG4gICAgfSk7XG4gICAgcmV0dXJuIGF3YWl0IGR5bmFtb0RiLnNlbmQoY29tbWFuZCk7XG4gIH1cbn0iXX0=